# 自动卡组扫描器使用指南

## 🎯 功能简介

**一键扫描整个卡组！** 不需要手动框选，让Bot自动点击卡组编辑界面的每张卡片并识别保存为模板。

## 📋 准备工作

### 1. 进入卡组编辑界面

在游戏中：
1. 进入卡组编辑
2. 选择要扫描的卡组
3. 确保卡组界面完全可见（不要有遮挡）

### 2. 确认位置

默认配置基于 **1920x1080** 分辨率。

如果你的分辨率不同，需要先校准位置。

## 🚀 使用方法

### 方式1：从主菜单运行

```bash
python main.py
# 选择 "5. 自动扫描卡组"
```

### 方式2：直接运行工具

```bash
python tools/auto_deck_scanner.py
```

## 📝 扫描流程

1. **准备阶段**
   - 输入卡组名称（或使用默认）
   - 确认游戏在卡组编辑界面
   - 按Enter开始

2. **自动扫描阶段**
   - Bot自动点击每张卡片
   - 捕获放大后的卡片图像
   - 使用OCR/图像识别
   - 保存为模板

3. **完成**
   - 显示统计信息
   - 保存卡组数据到 `data/decks/`
   - 保存卡片模板到 `data/templates/`

## 🎨 扫描效果

扫描完成后，你会得到：

### 卡组数据文件
位置: `data/decks/<卡组名称>.json`

内容示例：
```json
{
  "deck_name": "my_deck",
  "main_deck": [
    {"name": "灰流丽", "confidence": 0.95},
    {"name": "增殖的G", "confidence": 0.92},
    ...
  ],
  "extra_deck": [
    {"name": "银河眼光子龙", "confidence": 0.88},
    ...
  ]
}
```

### 卡片模板库
所有识别的卡片自动保存到 `data/templates/`，可以用于后续的卡片识别！

## ⚙️ 位置校准

如果扫描位置不准确：

```bash
python tools/auto_deck_scanner.py
# 选择 "2=校准位置"
```

然后：
1. 手动点击第一张卡
2. 查看生成的 `calibration_screenshot.png`  
3. 编辑 `auto_deck_scanner.py` 中的坐标：
   ```python
   self.main_deck_grid = {
       'start_x': <你的x坐标>,
       'start_y': <你的y坐标>,
       ...
   }
   ```

## 🔧 高级配置

### 调整扫描速度

编辑 `auto_deck_scanner.py`:
```python
# 第84行
time.sleep(0.3)  # 改为0.5使扫描更稳定，或0.2使扫描更快
```

### 不同分辨率

根据你的分辨率按比例调整所有坐标。

例如对于2560x1440：
```python
'start_x': 285 * (2560/1920),  # 按比例缩放
'start_y': 130 * (1440/1080),
```

## ❓ 常见问题

### Q: 扫描到一半停了？

**A**: 可能点击位置不准，尝试：
1. 运行校准模式
2. 调整 `time.sleep()` 延迟
3. 确保窗口没有被遮挡

### Q: 识别准确率低？

**A**: 
1. 确保卡片详情区域清晰
2. 检查OCR是否正确安装
3. 扫描完后手动检查 `data/templates/`
4. 可以重新扫描特定卡片

### Q: 可以扫描多个卡组吗？

**A**: 当然！每次扫描输入不同的卡组名称即可

### Q: 扫描会不会影响模板库？

**A**: 不会！每张卡只会保存一次（基于名称hash），重复的卡不会重复保存

## 💡 使用技巧

### 技巧1: 先扫描常用卡组

扫描2-3个常用卡组，可以快速建立完整的模板库！

### 技巧2: 结合手动采集

- 自动扫描：快速建立基础库
- 手动采集：添加特殊卡片或提高质量

### 技巧3: 批量处理

```bash
# 扫描所有卡组
for i in {1..5}; do
    python tools/auto_deck_scanner.py
done
```

## 📊 性能

- **扫描速度**: 约2-3秒/张卡
- **一个卡组**: 约2-3分钟（40-60张）
- **识别准确率**: 80-95%（依赖OCR和已有模板）

## ⚠️ 注意事项

1. **保持游戏窗口激活**: 扫描过程中不要切换窗口
2. **不要移动鼠标**: Bot需要自动控制鼠标
3. **检查结果**: 扫描完后查看 `data/decks/` 确认
4. **备份数据**: 重要的卡组数据建议备份

---

**现在开始扫描你的卡组吧！**🚀
